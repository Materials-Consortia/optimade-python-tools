services:
  - mongodb
language: python
python:
  - "3.6"
install:
   - pip install -e .
   - pip install -r requirements.txt
   - pip install -r requirements-optional.txt
script:
   - pytest
   - openapi-spec-validator openapi.json
     # start server to generate schema then kill it
   - timeout 2 ./run.sh; if [ $? -eq 124 ]; then return 0; else return 1; fi
     # check whether generated schema matches the committed version
   - .ci/diff_spec.sh
