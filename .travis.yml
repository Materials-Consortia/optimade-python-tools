services:
  - mongodb
language: python
python:
  - "3.6"
install:
   - pip install -e .
   - pip install -r requirements.txt
   - pip install -r requirements-optional.txt
script:
   - pytest
   - openapi-spec-validator openapi.json
     # start server to generate schema then kill it
   - timeout 0.5 ./run.sh
     # check whether generated schema matches the committed version
   - diff=$(jsondiff openapi.json local_openapi.json); \
     if [ ! "$diff" = "{}" ]; then \
        echo "Generate OpenAPI spec did not match committed version. Diff:\n $diff"; \
        return 1; \
     fi
