
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the OPTIMADE Python tools">
      
      
      
        <link rel="canonical" href="https://www.optimade.org/optimade-python-tools/0.23.0/api_reference/client/client/">
      
      
        <link rel="prev" href="../cli/">
      
      
        <link rel="next" href="../utils/">
      
      <link rel="icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>client - OPTIMADE Python tools</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karla:300,300i,400,400i,700,700i%7CShare+Tech+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Karla";--md-code-font:"Share Tech Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/reference.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#client" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OPTIMADE Python tools" class="md-header__button md-logo" aria-label="OPTIMADE Python tools" data-md-component="logo">
      
  <img src="https://matsci.org/uploads/default/original/2X/b/bd2f59b3bf14fb046b74538750699d7da4c19ac1.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OPTIMADE Python tools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              client
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    optimade-python-tools
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OPTIMADE Python tools" class="md-nav__button md-logo" aria-label="OPTIMADE Python tools" data-md-component="logo">
      
  <img src="https://matsci.org/uploads/default/original/2X/b/bd2f59b3bf14fb046b74538750699d7da4c19ac1.svg" alt="logo">

    </a>
    OPTIMADE Python tools
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    optimade-python-tools
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../INSTALL/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/client/" class="md-nav__link">
        Using the OPTIMADE client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/setting_up_an_api/" class="md-nav__link">
        Setting up an OPTIMADE API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/use_cases/" class="md-nav__link">
        Example use cases
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/integrated/" class="md-nav__link">
        Integrate OPTIMADE with an existing web application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/container/" class="md-nav__link">
        Run in a container (Docker)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/validation/" class="md-nav__link">
        Validation of OPTIMADE APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/filtering/" class="md-nav__link">
        Filter parsing and transforming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        Contributing and getting help
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../all_models/" class="md-nav__link">
        OPTIMADE Data Models
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
          adapters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_4">
          <span class="md-nav__icon md-icon"></span>
          adapters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4_5" id="__nav_10_4_5_label" tabindex="0">
          references
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_4_5">
          <span class="md-nav__icon md-icon"></span>
          references
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/references/adapter/" class="md-nav__link">
        adapter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4_6" id="__nav_10_4_6_label" tabindex="0">
          structures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_4_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_4_6">
          <span class="md-nav__icon md-icon"></span>
          structures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/adapter/" class="md-nav__link">
        adapter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/aiida/" class="md-nav__link">
        aiida
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/ase/" class="md-nav__link">
        ase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/cif/" class="md-nav__link">
        cif
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/jarvis/" class="md-nav__link">
        jarvis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/proteindatabank/" class="md-nav__link">
        proteindatabank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/pymatgen/" class="md-nav__link">
        pymatgen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../adapters/structures/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_10_5" id="__nav_10_5_label" tabindex="0">
          client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_10_5">
          <span class="md-nav__icon md-icon"></span>
          client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        cli
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        client
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optimade.client.client" class="md-nav__link">
    optimade.client.client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient" class="md-nav__link">
    OptimadeClient
  </a>
  
    <nav class="md-nav" aria-label="OptimadeClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.all_results" class="md-nav__link">
    all_results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.callbacks" class="md-nav__link">
    callbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.count_results" class="md-nav__link">
    count_results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.headers" class="md-nav__link">
    headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.http_timeout" class="md-nav__link">
    http_timeout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.max_results_per_provider" class="md-nav__link">
    max_results_per_provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.__getattribute__" class="md-nav__link">
    __getattribute__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get_one" class="md-nav__link">
    get_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get_one_async" class="md-nav__link">
    get_one_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_6" >
      
      
      
        <label class="md-nav__link" for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
          filterparser
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_6">
          <span class="md-nav__icon md-icon"></span>
          filterparser
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../filterparser/lark_parser/" class="md-nav__link">
        lark_parser
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7" >
      
      
      
        <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
          filtertransformers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_7">
          <span class="md-nav__icon md-icon"></span>
          filtertransformers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../filtertransformers/base_transformer/" class="md-nav__link">
        base_transformer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../filtertransformers/elasticsearch/" class="md-nav__link">
        elasticsearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../filtertransformers/mongo/" class="md-nav__link">
        mongo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_8" >
      
      
      
        <label class="md-nav__link" for="__nav_10_8" id="__nav_10_8_label" tabindex="0">
          models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_8">
          <span class="md-nav__icon md-icon"></span>
          models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/baseinfo/" class="md-nav__link">
        baseinfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/entries/" class="md-nav__link">
        entries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/index_metadb/" class="md-nav__link">
        index_metadb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/jsonapi/" class="md-nav__link">
        jsonapi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/optimade_json/" class="md-nav__link">
        optimade_json
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/responses/" class="md-nav__link">
        responses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9" id="__nav_10_9_label" tabindex="0">
          server
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_9">
          <span class="md-nav__icon md-icon"></span>
          server
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/exception_handlers/" class="md-nav__link">
        exception_handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/main/" class="md-nav__link">
        main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/main_index/" class="md-nav__link">
        main_index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/middleware/" class="md-nav__link">
        middleware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/query_params/" class="md-nav__link">
        query_params
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/schemas/" class="md-nav__link">
        schemas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9_11" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_11" id="__nav_10_9_11_label" tabindex="0">
          entry_collections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_9_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_9_11">
          <span class="md-nav__icon md-icon"></span>
          entry_collections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/entry_collections/elasticsearch/" class="md-nav__link">
        elasticsearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/entry_collections/entry_collections/" class="md-nav__link">
        entry_collections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/entry_collections/mongo/" class="md-nav__link">
        mongo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9_12" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_12" id="__nav_10_9_12_label" tabindex="0">
          mappers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_9_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_9_12">
          <span class="md-nav__icon md-icon"></span>
          mappers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/mappers/entries/" class="md-nav__link">
        entries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/mappers/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/mappers/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/mappers/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9_13" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_13" id="__nav_10_9_13_label" tabindex="0">
          routers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_9_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_9_13">
          <span class="md-nav__icon md-icon"></span>
          routers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/index_info/" class="md-nav__link">
        index_info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/info/" class="md-nav__link">
        info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/landing/" class="md-nav__link">
        landing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../server/routers/versions/" class="md-nav__link">
        versions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10_10" id="__nav_10_10_label" tabindex="0">
          validator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_10">
          <span class="md-nav__icon md-icon"></span>
          validator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validator/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validator/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validator/validator/" class="md-nav__link">
        validator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optimade.client.client" class="md-nav__link">
    optimade.client.client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient" class="md-nav__link">
    OptimadeClient
  </a>
  
    <nav class="md-nav" aria-label="OptimadeClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.all_results" class="md-nav__link">
    all_results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.callbacks" class="md-nav__link">
    callbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.count_results" class="md-nav__link">
    count_results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.headers" class="md-nav__link">
    headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.http_timeout" class="md-nav__link">
    http_timeout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.max_results_per_provider" class="md-nav__link">
    max_results_per_provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.__getattribute__" class="md-nav__link">
    __getattribute__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get_one" class="md-nav__link">
    get_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimade.client.client.OptimadeClient.get_one_async" class="md-nav__link">
    get_one_async()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="client">client<a class="headerlink" href="#client" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="optimade.client.client"></a>
    <div class="doc doc-contents first">

      <p>This module implements OPTIMADE client functionality for:</p>
<ul>
<li>making web requests to filter and harvest resources from OPTIMADE APIs,</li>
<li>query multiple providers simultaneously.</li>
</ul>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h2 id="optimade.client.client.OptimadeClient" class="doc doc-heading">
        <code>
OptimadeClient        </code>



<a href="#optimade.client.client.OptimadeClient" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>This class implemements a client for executing the same queries
across multiple OPTIMADE APIs simultaneously, paging and caching the
results.</p>
<p>By default, all registered OPTIMADE providers will be queried
simulateneously and asynchronously, with the results collected
into the <code>all_results</code> attribute, keyed by endpoint, filter
and provider.</p>

        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">OptimadeClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implemements a client for executing the same queries</span>
<span class="sd">    across multiple OPTIMADE APIs simultaneously, paging and caching the</span>
<span class="sd">    results.</span>

<span class="sd">    By default, all registered OPTIMADE providers will be queried</span>
<span class="sd">    simulateneously and asynchronously, with the results collected</span>
<span class="sd">    into the `all_results` attribute, keyed by endpoint, filter</span>
<span class="sd">    and provider.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">base_urls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list (or any iterable) of OPTIMADE base URLs to query.&quot;&quot;&quot;</span>

    <span class="n">all_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A nested dictionary keyed by endpoint and OPTIMADE filter string that contains</span>
<span class="sd">    the results from each base URL for that particular filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">count_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A nested dictionary keyed by endpoint and OPTIMADE filter string that contains</span>
<span class="sd">    the number of results from each base URL for that particular filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_results_per_provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of results to downlod per provider. If None, will</span>
<span class="sd">    download all.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;optimade-python-tools/</span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Additional HTTP headers.&quot;&quot;&quot;</span>

    <span class="n">http_timeout</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The timeout to use for each HTTP request.&quot;&quot;&quot;</span>

    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The maximum number of times to repeat a failed query before giving up.&quot;&quot;&quot;</span>

    <span class="n">use_async</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether or not to make all requests asynchronously using asyncio.&quot;&quot;&quot;</span>

    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of callbacks to execute after each successful request, used</span>
<span class="sd">    to e.g., write to a file, add results to a database or perform additional</span>
<span class="sd">    filtering.</span>

<span class="sd">    The callbacks will receive the request URL and the results extracted</span>
<span class="sd">    from the JSON response, with keys &#39;data&#39;, &#39;meta&#39;, &#39;links&#39;, &#39;errors&#39;</span>
<span class="sd">    and &#39;included&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to disable progress bar printing.&quot;&quot;&quot;</span>

    <span class="n">_excluded_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of providers IDs excluded from future queries.&quot;&quot;&quot;</span>

    <span class="n">_included_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of providers IDs included from future queries.&quot;&quot;&quot;</span>

    <span class="n">_excluded_databases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of child database URLs excluded from future queries.&quot;&quot;&quot;</span>

    <span class="n">__current_endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used internally when querying via `client.structures.get()` to set the</span>
<span class="sd">    chosen endpoint. Should be reset to `None` outside of all `get()` calls.&quot;&quot;&quot;</span>

    <span class="n">_http_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override the HTTP client class, primarily used for testing.&quot;&quot;&quot;</span>

    <span class="n">__strict_async</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether or not to fallover if `use_async` is true yet asynchronous mode</span>
<span class="sd">    is impossible due to, e.g., a running event loop.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_urls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_results_per_provider</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">http_timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">use_async</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_databases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">http_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the OPTIMADE client object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            base_urls: A list of OPTIMADE base URLs to query.</span>
<span class="sd">            max_results_per_provider: The maximum number of results to download</span>
<span class="sd">                from each provider (-1 or 0 indicate unlimited).</span>
<span class="sd">            headers: Any additional HTTP headers to use for the queries.</span>
<span class="sd">            http_timeout: The timeout to use per request. Defaults to 10</span>
<span class="sd">                seconds with 1000 seconds for reads specifically. Overriding this value</span>
<span class="sd">                will replace all timeouts (connect, read, write and pool) with this value.</span>
<span class="sd">            max_attempts: The maximum number of times to repeat a failing query.</span>
<span class="sd">            use_async: Whether or not to make all requests asynchronously.</span>
<span class="sd">            exclude_providers: A set or collection of provider IDs to exclude from queries.</span>
<span class="sd">            include_providers: A set or collection of provider IDs to include in queries.</span>
<span class="sd">            exclude_databases: A set or collection of child database URLs to exclude from queries.</span>
<span class="sd">            http_client: An override for the underlying HTTP client, primarily used for testing.</span>
<span class="sd">            callbacks: A list of functions to call after each successful response, see the</span>
<span class="sd">                attribute [`OptimadeClient.callbacks`][optimade.client.OptimadeClient.callbacks]</span>
<span class="sd">                docstring for more details.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="o">=</span> <span class="n">max_results_per_provider</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_excluded_providers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_providers</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude_providers</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_included_providers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include_providers</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_providers</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_excluded_databases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_databases</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude_databases</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_urls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="n">get_all_databases</span><span class="p">(</span>
                <span class="n">exclude_providers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_excluded_providers</span><span class="p">,</span>
                <span class="n">include_providers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_included_providers</span><span class="p">,</span>
                <span class="n">exclude_databases</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_excluded_databases</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclude_providers</span> <span class="ow">or</span> <span class="n">include_providers</span> <span class="ow">or</span> <span class="n">exclude_databases</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot provide both a list of base URLs and included/excluded databases.&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="n">base_urls</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span>
                <span class="s2">&quot;Unable to access any OPTIMADE base URLs. If you believe this is an error, try manually specifying some base URLs.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">http_timeout</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">http_timeout</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span> <span class="o">=</span> <span class="n">http_timeout</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="n">http_timeout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span> <span class="o">=</span> <span class="n">max_attempts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="n">use_async</span>

        <span class="k">if</span> <span class="n">http_client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">http_client</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strict_async</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot use synchronous mode with an asynchronous HTTP client, please set `use_async=True` or pass an asynchronous HTTP client.&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strict_async</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot use async mode with a synchronous HTTP client, please set `use_async=False` or pass an synchronous HTTP client.&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_async</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>

    <span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allows entry endpoints to be queried via attribute access, using the</span>
<span class="sd">        allowed list for this module.</span>

<span class="sd">        Should also pass through any `extensions/&lt;example&gt;` endpoints.</span>

<span class="sd">        Any non-entry-endpoint name requested will be passed to the</span>
<span class="sd">        original `__getattribute__`.</span>

<span class="sd">        !!! example</span>
<span class="sd">            ```python</span>
<span class="sd">            from optimade.client import OptimadeClient</span>
<span class="sd">            cli = OptimadeClient()</span>
<span class="sd">            structures = cli.structures.get()</span>
<span class="sd">            references = cli.references.get()</span>
<span class="sd">            info_structures = cli.info.structures.get()</span>
<span class="sd">            ```</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ENDPOINTS</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;info/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">==</span> <span class="s2">&quot;extensions&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;extensions/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the results from the endpoint and filter across the</span>
<span class="sd">        defined OPTIMADE APIs.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            filter: The OPTIMADE filter string for the query.</span>
<span class="sd">            endpoint: The endpoint to query.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the query could not be executed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A nested mapping from endpoint, filter and base URL to the query results.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;structures&quot;</span>

        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">OptimadeClientProgress</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">disable</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="n">Panel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Performing query [bold yellow]</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">[/bold yellow]/?filter=[bold magenta][i]</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">[/i][/bold magenta]&quot;</span><span class="p">,</span>
                        <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_queries</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="p">,</span>
                <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                <span class="n">page_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">[</span><span class="n">endpoint</span><span class="p">][</span><span class="nb">filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">endpoint</span><span class="p">:</span> <span class="p">{</span><span class="nb">filter</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts the number of results for the filter, requiring</span>
<span class="sd">        only 1 request per provider by making use of the `meta-&gt;data_returned`</span>
<span class="sd">        key.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the query could not be executed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A nested mapping from endpoint, filter and base URL to the number of query results.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;structures&quot;</span>

        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">OptimadeClientProgress</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">disable</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="n">Panel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Counting results for [bold yellow]</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">[/bold yellow]/?filter=[bold magenta][i]</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">[/i][/bold magenta]&quot;</span><span class="p">,</span>
                        <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_queries</span><span class="p">(</span>
                <span class="nb">filter</span><span class="p">,</span>
                <span class="n">endpoint</span><span class="p">,</span>
                <span class="n">page_limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">paginate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">response_fields</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">count_results</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">base_url</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">count_results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;data_returned&quot;</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">count_results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2"> did not return a value for `meta-&gt;data_returned`, unable to count results. Full response: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">count_results</span><span class="p">[</span><span class="n">endpoint</span><span class="p">][</span><span class="nb">filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_results</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">endpoint</span><span class="p">:</span> <span class="p">{</span><span class="nb">filter</span><span class="p">:</span> <span class="n">count_results</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">_execute_queries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the queries over the base URLs either asynchronously or</span>
<span class="sd">        serially, depending on the `self.use_async` setting.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            filter: The OPTIMADE filter string.</span>
<span class="sd">            endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">            page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">                conjunction with `paginate`).</span>
<span class="sd">            paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">                value of `max_results_per_provider`) or whether to return</span>
<span class="sd">                after one page.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A mapping from base URL to `QueryResults` for each queried API.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span><span class="p">:</span>
            <span class="c1"># Check for a pre-existing event loop (e.g. within a Jupyter notebook)</span>
            <span class="c1"># and use it if present</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">event_loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">event_loop</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strict_async</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="s2">&quot;Detected a running event loop, cannot run in async mode.&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                        <span class="s2">&quot;Detected a running event loop (e.g., Jupyter, pytest). Trying to use nest_asyncio.&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">event_loop</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">event_loop</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_async</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="p">,</span>
                    <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
                    <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
                    <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_one</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the query synchronously on one API.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">            filter: The OPTIMADE filter string.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>
<span class="sd">            page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">                conjunction with `paginate`).</span>
<span class="sd">            paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">                value of `max_results_per_provider`) or whether to return</span>
<span class="sd">                after one page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_one</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">,</span>
                <span class="n">base_url</span><span class="p">,</span>
                <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
                <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
                <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">error_query_results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
            <span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[red]Error[/red]: Provider </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> returned: [red i]</span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">[/red i]&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">base_url</span><span class="p">:</span> <span class="n">error_query_results</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_all_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the query asynchronously across all defined APIs.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">            filter: The OPTIMADE filter string.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>
<span class="sd">            page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">                conjunction with `paginate`).</span>
<span class="sd">            paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">                value of `max_results_per_provider`) or whether to return</span>
<span class="sd">                after one page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_one_async</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="p">,</span>
                    <span class="n">base_url</span><span class="p">,</span>
                    <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
                    <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
                    <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">base_url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">r1</span><span class="p">,</span> <span class="o">**</span><span class="n">r2</span><span class="p">},</span> <span class="n">results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the query synchronously across all defined APIs.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">            filter: The OPTIMADE filter string.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>
<span class="sd">            page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">                conjunction with `paginate`).</span>
<span class="sd">            paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">                value of `max_results_per_provider`) or whether to return</span>
<span class="sd">                after one page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_one</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">,</span>
                <span class="n">base_url</span><span class="p">,</span>
                <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
                <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
                <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">base_url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">r1</span><span class="p">,</span> <span class="o">**</span><span class="n">r2</span><span class="p">},</span> <span class="n">results</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_one_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the query asynchronously on one API.</span>

<span class="sd">        !!! note</span>
<span class="sd">            This method currently makes non-blocking requests</span>
<span class="sd">            to a single API, but these requests are executed</span>
<span class="sd">            serially on that API, i.e., results are pulled one</span>
<span class="sd">            page at a time, but requests will not block other</span>
<span class="sd">            async requests to other APIs.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">            filter: The OPTIMADE filter string.</span>
<span class="sd">            response_fields: A list of response fields to request</span>
<span class="sd">                from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>
<span class="sd">            page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">                conjunction with `paginate`).</span>
<span class="sd">            paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">                value of `max_results_per_provider`) or whether to return</span>
<span class="sd">                after one page.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_one_async</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">,</span>
                <span class="n">base_url</span><span class="p">,</span>
                <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
                <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
                <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
                <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">error_query_results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
            <span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[red]Error[/red]: Provider </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> returned: [red i]</span><span class="si">{</span><span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span><span class="si">}</span><span class="s2">[/red i]&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">base_url</span><span class="p">:</span> <span class="n">error_query_results</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_one_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;See [`OptimadeClient.get_one_async`][optimade.client.OptimadeClient.get_one_async].&quot;&quot;&quot;</span>
        <span class="n">next_url</span><span class="p">,</span> <span class="n">_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>  <span class="c1"># type: ignore[union-attr,call-arg,misc]</span>
                <span class="k">while</span> <span class="n">next_url</span><span class="p">:</span>
                    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="n">next_url</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span>
                        <span class="p">)</span>
                        <span class="n">page_results</span><span class="p">,</span> <span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_response</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">_task</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">RecoverableHTTPError</span><span class="p">:</span>
                        <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">attempts</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Exceeded maximum number of retries for </span><span class="si">{</span><span class="n">next_url</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">page_results</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">paginate</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span>
                        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Reached </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> results for </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">, exceeding `max_results_per_provider` parameter (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span><span class="si">}</span><span class="s2">). Stopping download.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">break</span>

            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span> <span class="n">results</span><span class="p">}</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_teardown</span><span class="p">(</span><span class="n">_task</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_one</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;See [`OptimadeClient.get_one`][optimade.client.OptimadeClient.get_one].&quot;&quot;&quot;</span>
        <span class="n">next_url</span><span class="p">,</span> <span class="n">_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>  <span class="c1"># type: ignore[misc]</span>
                <span class="n">client</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
                    <span class="c1"># Convert configured httpx timeout to requests-style tuple</span>
                    <span class="n">timeout</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>

                <span class="k">while</span> <span class="n">next_url</span><span class="p">:</span>
                    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
                        <span class="n">page_results</span><span class="p">,</span> <span class="n">next_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_response</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">_task</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">RecoverableHTTPError</span><span class="p">:</span>
                        <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">attempts</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Exceeded maximum number of retries for </span><span class="si">{</span><span class="n">next_url</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">page_results</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span>
                        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Reached </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> results for </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">, exceeding `max_results_per_provider` parameter (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span><span class="si">}</span><span class="s2">). Stopping download.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">paginate</span><span class="p">:</span>
                        <span class="k">break</span>

            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span> <span class="n">results</span><span class="p">}</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_teardown</span><span class="p">(</span><span class="n">_task</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TaskID</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs the first query URL and creates the progress bar task.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The URL for the first query and the Rich TaskID for progress logging.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_url</span><span class="p">(</span>
            <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span> <span class="o">+</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">_task</span>

    <span class="k">def</span> <span class="nf">_build_url</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;structures&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the URL to query based on the passed parameters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            base_url: The server&#39;s base URL.</span>
<span class="sd">            endpoint: The endpoint to query.</span>
<span class="sd">            version: The OPTIMADE version string.</span>
<span class="sd">            filter: The filter to apply to the endpoint.</span>
<span class="sd">            response_fields: A list of response fields to request from the server.</span>
<span class="sd">            sort: The field by which to sort the results.</span>
<span class="sd">            page_limit: The page limit for an individual request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The overall query URL, including parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;v</span><span class="si">{</span><span class="n">__api_version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">while</span> <span class="n">base_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Handle params</span>
        <span class="n">_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="n">_filter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;filter=</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">response_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If we have requested no response fields (e.g., in the case of --count) then just ask for IDs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_response_fields</span> <span class="o">=</span> <span class="s2">&quot;response_fields=id&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_response_fields</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;response_fields=</span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response_fields</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">page_limit</span><span class="p">:</span>
            <span class="n">_page_limit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;page_limit=</span><span class="si">{</span><span class="n">page_limit</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="n">_sort</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sort=</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_filter</span><span class="p">,</span> <span class="n">_response_fields</span><span class="p">,</span> <span class="n">_page_limit</span><span class="p">,</span> <span class="n">_sort</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;?</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">_check_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Passes the filter through [`LarkParser`][optimade.filterparser.LarkParser]</span>
<span class="sd">        from the optimade-python-tools reference server implementation.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            filter: The filter string.</span>
<span class="sd">            endpoint: The endpoint being queried. If this endpoint is not &quot;known&quot; to</span>
<span class="sd">                OPTIMADE, the filter will automatically pass.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the filter cannot be parsed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">ENDPOINTS</span><span class="p">:</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="n">LarkParser</span><span class="p">()</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BadRequest</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[bold red]Filter [blue i]</span><span class="si">{</span><span class="nb">filter</span><span class="si">!r}</span><span class="s2">[/blue i] could not be parsed as an OPTIMADE filter.[/bold red]&quot;</span><span class="p">,</span>
                <span class="n">Panel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[magenta]</span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">[/magenta]&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="n">silent_raise</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_handle_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">],</span> <span class="n">_task</span><span class="p">:</span> <span class="n">TaskID</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the response from the server.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            response: The response from the server.</span>
<span class="sd">            _task: The Rich TaskID for this task&#39;s progressbar.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the results, and a link to the next page,</span>
<span class="sd">            if it exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Handle error statuses</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TooManyRequestsException</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">)</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;detail&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not decode response as JSON: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="c1"># Accumulate results with correct empty containers if missing</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s2">&quot;links&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="s2">&quot;included&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;included&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">}</span>

        <span class="c1"># Advance the progress bar for this provider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">_task</span><span class="p">,</span>
            <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]),</span>
            <span class="n">total</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_returned&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_callbacks</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="n">next_url</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">next_url</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">next_url</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">next_url</span>

    <span class="k">def</span> <span class="nf">_teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_task</span><span class="p">:</span> <span class="n">TaskID</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the finished status of the progress bar depending on the number of results.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            _task: The Rich TaskID for this task&#39;s progressbar.</span>
<span class="sd">            num_results: The number of data entries returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_results</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_task</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finished</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">_task</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">num_results</span><span class="p">,</span> <span class="n">finished</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_callbacks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute any callbacks registered with the client.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            results: The results from the query.</span>
<span class="sd">            response: The full response from the server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="n">callback</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.all_results" class="doc doc-heading">
<code class="highlight language-python"><span class="n">all_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">optimade</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">QueryResults</span><span class="p">]]]</span></code>


<a href="#optimade.client.client.OptimadeClient.all_results" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A nested dictionary keyed by endpoint and OPTIMADE filter string that contains
the results from each base URL for that particular filter.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.callbacks" class="doc doc-heading">
<code class="highlight language-python"><span class="n">callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]]</span></code>


<a href="#optimade.client.client.OptimadeClient.callbacks" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A list of callbacks to execute after each successful request, used
to e.g., write to a file, add results to a database or perform additional
filtering.</p>
<p>The callbacks will receive the request URL and the results extracted
from the JSON response, with keys 'data', 'meta', 'links', 'errors'
and 'included'.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.count_results" class="doc doc-heading">
<code class="highlight language-python"><span class="n">count_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span></code>


<a href="#optimade.client.client.OptimadeClient.count_results" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A nested dictionary keyed by endpoint and OPTIMADE filter string that contains
the number of results from each base URL for that particular filter.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.headers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span></code>


<a href="#optimade.client.client.OptimadeClient.headers" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Additional HTTP headers.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.http_timeout" class="doc doc-heading">
<code class="highlight language-python"><span class="n">http_timeout</span><span class="p">:</span> <span class="n">Timeout</span></code>


<a href="#optimade.client.client.OptimadeClient.http_timeout" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>The timeout to use for each HTTP request.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="optimade.client.client.OptimadeClient.max_results_per_provider" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_results_per_provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>


<a href="#optimade.client.client.OptimadeClient.max_results_per_provider" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Maximum number of results to downlod per provider. If None, will
download all.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.__getattribute__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#optimade.client.client.OptimadeClient.__getattribute__" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Allows entry endpoints to be queried via attribute access, using the
allowed list for this module.</p>
<p>Should also pass through any <code>extensions/&lt;example&gt;</code> endpoints.</p>
<p>Any non-entry-endpoint name requested will be passed to the
original <code>__getattribute__</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">optimade.client</span> <span class="kn">import</span> <span class="n">OptimadeClient</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">OptimadeClient</span><span class="p">()</span>
<span class="n">structures</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">references</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">info_structures</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>
</div>

        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows entry endpoints to be queried via attribute access, using the</span>
<span class="sd">    allowed list for this module.</span>

<span class="sd">    Should also pass through any `extensions/&lt;example&gt;` endpoints.</span>

<span class="sd">    Any non-entry-endpoint name requested will be passed to the</span>
<span class="sd">    original `__getattribute__`.</span>

<span class="sd">    !!! example</span>
<span class="sd">        ```python</span>
<span class="sd">        from optimade.client import OptimadeClient</span>
<span class="sd">        cli = OptimadeClient()</span>
<span class="sd">        structures = cli.structures.get()</span>
<span class="sd">        references = cli.references.get()</span>
<span class="sd">        info_structures = cli.info.structures.get()</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ENDPOINTS</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;info/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">==</span> <span class="s2">&quot;extensions&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;extensions/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_urls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_results_per_provider</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">http_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">use_async</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_providers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_providers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_databases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">http_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#optimade.client.client.OptimadeClient.__init__" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Create the OPTIMADE client object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>base_urls</code></td>
        <td><code>Union[str, Iterable[str]]</code></td>
        <td><p>A list of OPTIMADE base URLs to query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_results_per_provider</code></td>
        <td><code>int</code></td>
        <td><p>The maximum number of results to download
from each provider (-1 or 0 indicate unlimited).</p></td>
        <td><code>1000</code></td>
      </tr>
      <tr>
        <td><code>headers</code></td>
        <td><code>Optional[Dict]</code></td>
        <td><p>Any additional HTTP headers to use for the queries.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>http_timeout</code></td>
        <td><code>Union[httpx.Timeout, float]</code></td>
        <td><p>The timeout to use per request. Defaults to 10
seconds with 1000 seconds for reads specifically. Overriding this value
will replace all timeouts (connect, read, write and pool) with this value.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_attempts</code></td>
        <td><code>int</code></td>
        <td><p>The maximum number of times to repeat a failing query.</p></td>
        <td><code>5</code></td>
      </tr>
      <tr>
        <td><code>use_async</code></td>
        <td><code>bool</code></td>
        <td><p>Whether or not to make all requests asynchronously.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>exclude_providers</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A set or collection of provider IDs to exclude from queries.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>include_providers</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A set or collection of provider IDs to include in queries.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>exclude_databases</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A set or collection of child database URLs to exclude from queries.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>http_client</code></td>
        <td><code>Union[Type[httpx.AsyncClient], Type[requests.sessions.Session]]</code></td>
        <td><p>An override for the underlying HTTP client, primarily used for testing.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>callbacks</code></td>
        <td><code>Optional[List[Callable[[str, Dict], NoneType]]]</code></td>
        <td><p>A list of functions to call after each successful response, see the
attribute <a class="autorefs autorefs-internal" href="#optimade.client.client.OptimadeClient.callbacks"><code>OptimadeClient.callbacks</code></a>
docstring for more details.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">base_urls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_results_per_provider</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">http_timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">use_async</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_providers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_databases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">http_client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the OPTIMADE client object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        base_urls: A list of OPTIMADE base URLs to query.</span>
<span class="sd">        max_results_per_provider: The maximum number of results to download</span>
<span class="sd">            from each provider (-1 or 0 indicate unlimited).</span>
<span class="sd">        headers: Any additional HTTP headers to use for the queries.</span>
<span class="sd">        http_timeout: The timeout to use per request. Defaults to 10</span>
<span class="sd">            seconds with 1000 seconds for reads specifically. Overriding this value</span>
<span class="sd">            will replace all timeouts (connect, read, write and pool) with this value.</span>
<span class="sd">        max_attempts: The maximum number of times to repeat a failing query.</span>
<span class="sd">        use_async: Whether or not to make all requests asynchronously.</span>
<span class="sd">        exclude_providers: A set or collection of provider IDs to exclude from queries.</span>
<span class="sd">        include_providers: A set or collection of provider IDs to include in queries.</span>
<span class="sd">        exclude_databases: A set or collection of child database URLs to exclude from queries.</span>
<span class="sd">        http_client: An override for the underlying HTTP client, primarily used for testing.</span>
<span class="sd">        callbacks: A list of functions to call after each successful response, see the</span>
<span class="sd">            attribute [`OptimadeClient.callbacks`][optimade.client.OptimadeClient.callbacks]</span>
<span class="sd">            docstring for more details.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="o">=</span> <span class="n">max_results_per_provider</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_results_per_provider</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_excluded_providers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_providers</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude_providers</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_included_providers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include_providers</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_providers</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_excluded_databases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude_databases</span><span class="p">)</span> <span class="k">if</span> <span class="n">exclude_databases</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">base_urls</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="n">get_all_databases</span><span class="p">(</span>
            <span class="n">exclude_providers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_excluded_providers</span><span class="p">,</span>
            <span class="n">include_providers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_included_providers</span><span class="p">,</span>
            <span class="n">exclude_databases</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_excluded_databases</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exclude_providers</span> <span class="ow">or</span> <span class="n">include_providers</span> <span class="ow">or</span> <span class="n">exclude_databases</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot provide both a list of base URLs and included/excluded databases.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="n">base_urls</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_urls</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span>
            <span class="s2">&quot;Unable to access any OPTIMADE base URLs. If you believe this is an error, try manually specifying some base URLs.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">http_timeout</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">http_timeout</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span> <span class="o">=</span> <span class="n">http_timeout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">http_timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="n">http_timeout</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_attempts</span> <span class="o">=</span> <span class="n">max_attempts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="n">use_async</span>

    <span class="k">if</span> <span class="n">http_client</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">http_client</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strict_async</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot use synchronous mode with an asynchronous HTTP client, please set `use_async=True` or pass an asynchronous HTTP client.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strict_async</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot use async mode with a synchronous HTTP client, please set `use_async=False` or pass an synchronous HTTP client.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_async</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">use_async</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#optimade.client.client.OptimadeClient.count" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Counts the number of results for the filter, requiring
only 1 request per provider by making use of the <code>meta-&gt;data_returned</code>
key.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the query could not be executed.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Dict[str, Dict[str, Optional[int]]]]</code></td>
      <td><p>A nested mapping from endpoint, filter and base URL to the number of query results.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Counts the number of results for the filter, requiring</span>
<span class="sd">    only 1 request per provider by making use of the `meta-&gt;data_returned`</span>
<span class="sd">    key.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the query could not be executed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A nested mapping from endpoint, filter and base URL to the number of query results.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;structures&quot;</span>

    <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">OptimadeClientProgress</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">disable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="n">Panel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Counting results for [bold yellow]</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">[/bold yellow]/?filter=[bold magenta][i]</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">[/i][/bold magenta]&quot;</span><span class="p">,</span>
                    <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_queries</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">paginate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">count_results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">base_url</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">count_results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;data_returned&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">count_results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2"> did not return a value for `meta-&gt;data_returned`, unable to count results. Full response: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="n">base_url</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">count_results</span><span class="p">[</span><span class="n">endpoint</span><span class="p">][</span><span class="nb">filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_results</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">endpoint</span><span class="p">:</span> <span class="p">{</span><span class="nb">filter</span><span class="p">:</span> <span class="n">count_results</span><span class="p">}}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.get" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">response_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#optimade.client.client.OptimadeClient.get" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Gets the results from the endpoint and filter across the
defined OPTIMADE APIs.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filter</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The OPTIMADE filter string for the query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>endpoint</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The endpoint to query.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>response_fields</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A list of response fields to request
from the server.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sort</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The field by which to sort the results.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the query could not be executed.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Dict[str, Dict[str, Dict]]]</code></td>
      <td><p>A nested mapping from endpoint, filter and base URL to the query results.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the results from the endpoint and filter across the</span>
<span class="sd">    defined OPTIMADE APIs.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        filter: The OPTIMADE filter string for the query.</span>
<span class="sd">        endpoint: The endpoint to query.</span>
<span class="sd">        response_fields: A list of response fields to request</span>
<span class="sd">            from the server.</span>
<span class="sd">        sort: The field by which to sort the results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the query could not be executed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A nested mapping from endpoint, filter and base URL to the query results.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_endpoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;structures&quot;</span>

    <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">OptimadeClientProgress</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">disable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="n">Panel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Performing query [bold yellow]</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">[/bold yellow]/?filter=[bold magenta][i]</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">[/i][/bold magenta]&quot;</span><span class="p">,</span>
                    <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_queries</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_results</span><span class="p">[</span><span class="n">endpoint</span><span class="p">][</span><span class="nb">filter</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">endpoint</span><span class="p">:</span> <span class="p">{</span><span class="nb">filter</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}}}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.get_one" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">response_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">page_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#optimade.client.client.OptimadeClient.get_one" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Executes the query synchronously on one API.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>endpoint</code></td>
        <td><code>str</code></td>
        <td><p>The OPTIMADE endpoint to query.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td><code>str</code></td>
        <td><p>The OPTIMADE filter string.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>response_fields</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A list of response fields to request
from the server.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sort</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The field by which to sort the results.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>page_limit</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>A page limit to enforce for each query (used in
conjunction with <code>paginate</code>).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paginate</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to pull all pages of results (up to the
value of <code>max_results_per_provider</code>) or whether to return
after one page.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, optimade.client.utils.QueryResults]</code></td>
      <td><p>A dictionary mapping from base URL to the results of the query.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_one</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the query synchronously on one API.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">        filter: The OPTIMADE filter string.</span>
<span class="sd">        response_fields: A list of response fields to request</span>
<span class="sd">            from the server.</span>
<span class="sd">        sort: The field by which to sort the results.</span>
<span class="sd">        page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">            conjunction with `paginate`).</span>
<span class="sd">        paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">            value of `max_results_per_provider`) or whether to return</span>
<span class="sd">            after one page.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_one</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">base_url</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">error_query_results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
        <span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[red]Error[/red]: Provider </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> returned: [red i]</span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">[/red i]&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">base_url</span><span class="p">:</span> <span class="n">error_query_results</span><span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="optimade.client.client.OptimadeClient.get_one_async" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_one_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">response_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">page_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paginate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

<a href="#optimade.client.client.OptimadeClient.get_one_async" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Executes the query asynchronously on one API.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method currently makes non-blocking requests
to a single API, but these requests are executed
serially on that API, i.e., results are pulled one
page at a time, but requests will not block other
async requests to other APIs.</p>
</div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>endpoint</code></td>
        <td><code>str</code></td>
        <td><p>The OPTIMADE endpoint to query.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>filter</code></td>
        <td><code>str</code></td>
        <td><p>The OPTIMADE filter string.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>response_fields</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>A list of response fields to request
from the server.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sort</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The field by which to sort the results.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>page_limit</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>A page limit to enforce for each query (used in
conjunction with <code>paginate</code>).</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>paginate</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to pull all pages of results (up to the
value of <code>max_results_per_provider</code>) or whether to return
after one page.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, optimade.client.utils.QueryResults]</code></td>
      <td><p>A dictionary mapping from base URL to the results of the query.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optimade/client/client.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_one_async</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">response_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">paginate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QueryResults</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the query asynchronously on one API.</span>

<span class="sd">    !!! note</span>
<span class="sd">        This method currently makes non-blocking requests</span>
<span class="sd">        to a single API, but these requests are executed</span>
<span class="sd">        serially on that API, i.e., results are pulled one</span>
<span class="sd">        page at a time, but requests will not block other</span>
<span class="sd">        async requests to other APIs.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        endpoint: The OPTIMADE endpoint to query.</span>
<span class="sd">        filter: The OPTIMADE filter string.</span>
<span class="sd">        response_fields: A list of response fields to request</span>
<span class="sd">            from the server.</span>
<span class="sd">        sort: The field by which to sort the results.</span>
<span class="sd">        page_limit: A page limit to enforce for each query (used in</span>
<span class="sd">            conjunction with `paginate`).</span>
<span class="sd">        paginate: Whether to pull all pages of results (up to the</span>
<span class="sd">            value of `max_results_per_provider`) or whether to return</span>
<span class="sd">            after one page.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary mapping from base URL to the results of the query.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_one_async</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">base_url</span><span class="p">,</span>
            <span class="n">page_limit</span><span class="o">=</span><span class="n">page_limit</span><span class="p">,</span>
            <span class="n">paginate</span><span class="o">=</span><span class="n">paginate</span><span class="p">,</span>
            <span class="n">response_fields</span><span class="o">=</span><span class="n">response_fields</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">error_query_results</span> <span class="o">=</span> <span class="n">QueryResults</span><span class="p">()</span>
        <span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[red]Error[/red]: Provider </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> returned: [red i]</span><span class="si">{</span><span class="n">error_query_results</span><span class="o">.</span><span class="n">errors</span><span class="si">}</span><span class="s2">[/red i]&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">base_url</span><span class="p">:</span> <span class="n">error_query_results</span><span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Built by the Materials-Consortia
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Materials-Consortia" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>