
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the OPTIMADE Python tools">
      
      
      
        <link rel="canonical" href="https://www.optimade.org/optimade-python-tools/latest/deployment/container/">
      
      
        <link rel="prev" href="../integrated/">
      
      
        <link rel="next" href="../../concepts/validation/">
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Run in a container (Docker) - OPTIMADE Python tools</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/reference.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="red">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#run-in-a-container-docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OPTIMADE Python tools" class="md-header__button md-logo" aria-label="OPTIMADE Python tools" data-md-component="logo">
      
  <img src="../../images/optimade_logo_180x180.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OPTIMADE Python tools
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Run in a container (Docker)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    optimade-python-tools
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OPTIMADE Python tools" class="md-nav__button md-logo" aria-label="OPTIMADE Python tools" data-md-component="logo">
      
  <img src="../../images/optimade_logo_180x180.svg" alt="logo">

    </a>
    OPTIMADE Python tools
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    optimade-python-tools
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/client/" class="md-nav__link">
        Using the OPTIMADE client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/setting_up_an_api/" class="md-nav__link">
        Setting up an OPTIMADE API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/use_cases/" class="md-nav__link">
        Example use cases
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="true">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrated/" class="md-nav__link">
        Integrate OPTIMADE with an existing web application
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Run in a container (Docker)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Run in a container (Docker)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#retrieve-the-container-image" class="md-nav__link">
    Retrieve the container image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-container-and-configure-the-server" class="md-nav__link">
    Prepare the container and configure the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-multiple-container-services-in-closed-network" class="md-nav__link">
    Example: Multiple container services in closed network
  </a>
  
    <nav class="md-nav" aria-label="Example: Multiple container services in closed network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-setup-closed-network" class="md-nav__link">
    1. Setup closed network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-mongodb-service" class="md-nav__link">
    2. Run MongoDB service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-run-the-optimade-service" class="md-nav__link">
    3. Run the OPTIMADE service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-setup-and-run-the-optimade-index-meta-database-service" class="md-nav__link">
    4. Setup and run the OPTIMADE index meta-database service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-test-the-services" class="md-nav__link">
    5. Test the services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/validation/" class="md-nav__link">
        Validation of OPTIMADE APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/filtering/" class="md-nav__link">
        Filter parsing and transforming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        Contributing and getting help
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../all_models/" class="md-nav__link">
        OPTIMADE Data Models
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" tabindex="0" aria-expanded="false">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_4" type="checkbox" id="__nav_10_4" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4" tabindex="0" aria-expanded="false">
          adapters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="adapters" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_4">
          <span class="md-nav__icon md-icon"></span>
          adapters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_4_5" type="checkbox" id="__nav_10_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4_5" tabindex="0" aria-expanded="false">
          references
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="references" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_4_5">
          <span class="md-nav__icon md-icon"></span>
          references
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/references/adapter/" class="md-nav__link">
        adapter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_4_6" type="checkbox" id="__nav_10_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4_6" tabindex="0" aria-expanded="false">
          structures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="structures" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_4_6">
          <span class="md-nav__icon md-icon"></span>
          structures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/adapter/" class="md-nav__link">
        adapter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/aiida/" class="md-nav__link">
        aiida
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/ase/" class="md-nav__link">
        ase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/cif/" class="md-nav__link">
        cif
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/jarvis/" class="md-nav__link">
        jarvis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/proteindatabank/" class="md-nav__link">
        proteindatabank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/pymatgen/" class="md-nav__link">
        pymatgen
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/adapters/structures/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_5" type="checkbox" id="__nav_10_5" >
      
      
      
        <label class="md-nav__link" for="__nav_10_5" tabindex="0" aria-expanded="false">
          client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="client" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_5">
          <span class="md-nav__icon md-icon"></span>
          client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/client/cli/" class="md-nav__link">
        cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/client/client/" class="md-nav__link">
        client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/client/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_6" type="checkbox" id="__nav_10_6" >
      
      
      
        <label class="md-nav__link" for="__nav_10_6" tabindex="0" aria-expanded="false">
          filterparser
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="filterparser" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_6">
          <span class="md-nav__icon md-icon"></span>
          filterparser
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/filterparser/lark_parser/" class="md-nav__link">
        lark_parser
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_7" type="checkbox" id="__nav_10_7" >
      
      
      
        <label class="md-nav__link" for="__nav_10_7" tabindex="0" aria-expanded="false">
          filtertransformers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="filtertransformers" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_7">
          <span class="md-nav__icon md-icon"></span>
          filtertransformers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/filtertransformers/base_transformer/" class="md-nav__link">
        base_transformer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/filtertransformers/elasticsearch/" class="md-nav__link">
        elasticsearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/filtertransformers/mongo/" class="md-nav__link">
        mongo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_8" type="checkbox" id="__nav_10_8" >
      
      
      
        <label class="md-nav__link" for="__nav_10_8" tabindex="0" aria-expanded="false">
          models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="models" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_8">
          <span class="md-nav__icon md-icon"></span>
          models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/baseinfo/" class="md-nav__link">
        baseinfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/entries/" class="md-nav__link">
        entries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/index_metadb/" class="md-nav__link">
        index_metadb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/jsonapi/" class="md-nav__link">
        jsonapi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/optimade_json/" class="md-nav__link">
        optimade_json
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/responses/" class="md-nav__link">
        responses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/models/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_9" type="checkbox" id="__nav_10_9" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9" tabindex="0" aria-expanded="false">
          server
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="server" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_9">
          <span class="md-nav__icon md-icon"></span>
          server
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/exception_handlers/" class="md-nav__link">
        exception_handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/main/" class="md-nav__link">
        main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/main_index/" class="md-nav__link">
        main_index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/middleware/" class="md-nav__link">
        middleware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/query_params/" class="md-nav__link">
        query_params
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/schemas/" class="md-nav__link">
        schemas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/warnings/" class="md-nav__link">
        warnings
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_9_11" type="checkbox" id="__nav_10_9_11" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_11" tabindex="0" aria-expanded="false">
          entry_collections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="entry_collections" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_9_11">
          <span class="md-nav__icon md-icon"></span>
          entry_collections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/entry_collections/elasticsearch/" class="md-nav__link">
        elasticsearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/entry_collections/entry_collections/" class="md-nav__link">
        entry_collections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/entry_collections/mongo/" class="md-nav__link">
        mongo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_9_12" type="checkbox" id="__nav_10_9_12" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_12" tabindex="0" aria-expanded="false">
          mappers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="mappers" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_9_12">
          <span class="md-nav__icon md-icon"></span>
          mappers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/mappers/entries/" class="md-nav__link">
        entries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/mappers/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/mappers/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/mappers/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_9_13" type="checkbox" id="__nav_10_9_13" >
      
      
      
        <label class="md-nav__link" for="__nav_10_9_13" tabindex="0" aria-expanded="false">
          routers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="routers" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_9_13">
          <span class="md-nav__icon md-icon"></span>
          routers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/index_info/" class="md-nav__link">
        index_info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/info/" class="md-nav__link">
        info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/landing/" class="md-nav__link">
        landing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/links/" class="md-nav__link">
        links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/references/" class="md-nav__link">
        references
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/structures/" class="md-nav__link">
        structures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/server/routers/versions/" class="md-nav__link">
        versions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10_10" type="checkbox" id="__nav_10_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10_10" tabindex="0" aria-expanded="false">
          validator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="validator" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_10">
          <span class="md-nav__icon md-icon"></span>
          validator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/validator/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/validator/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/validator/validator/" class="md-nav__link">
        validator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#retrieve-the-container-image" class="md-nav__link">
    Retrieve the container image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-container-and-configure-the-server" class="md-nav__link">
    Prepare the container and configure the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-multiple-container-services-in-closed-network" class="md-nav__link">
    Example: Multiple container services in closed network
  </a>
  
    <nav class="md-nav" aria-label="Example: Multiple container services in closed network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-setup-closed-network" class="md-nav__link">
    1. Setup closed network
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-run-mongodb-service" class="md-nav__link">
    2. Run MongoDB service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-run-the-optimade-service" class="md-nav__link">
    3. Run the OPTIMADE service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-setup-and-run-the-optimade-index-meta-database-service" class="md-nav__link">
    4. Setup and run the OPTIMADE index meta-database service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-test-the-services" class="md-nav__link">
    5. Test the services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="run-in-a-container-docker">Run in a container (Docker)<a class="headerlink" href="#run-in-a-container-docker" title="Permanent link">&para;</a></h1>
<!-- markdownlint-disable MD046 -->

<h2 id="retrieve-the-container-image">Retrieve the container image<a class="headerlink" href="#retrieve-the-container-image" title="Permanent link">&para;</a></h2>
<p>Retrieving the container image is explained in the <a href="../../INSTALL/#retrieve-the-image">installation instructions</a>.
In short, using <a href="https://docs.docker.com">Docker</a> you can run:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>ghcr.io/materials-consortia/optimade
</code></pre></div>
<p>A general overview on running a container is also given in the <a href="../../INSTALL/#run-a-container">installations instructions</a>.</p>
<h2 id="prepare-the-container-and-configure-the-server">Prepare the container and configure the server<a class="headerlink" href="#prepare-the-container-and-configure-the-server" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A more complete overview of configuring the OPTIMADE server can be seen in the <a href="../../configuration/">configuration section</a>.</p>
</div>
<p>By default, the server will use the test configuration, including test data for structures and references and an in-memory mongomock database backend.
This can be changed in several different ways.</p>
<p>One is to <code>git clone</code> the repository locally and bind the repository folder to the <code>/app</code> folder in the container:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># volume will bind the local version of `optimade-python-tools` to the container.</span>
docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--detach<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--publish<span class="w"> </span><span class="m">8080</span>:5000<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">MAIN</span><span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>my-optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--volume<span class="w"> </span>/path/to/optimade-python-tools:/app<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ghcr.io/materials-consortia/optimade:latest
</code></pre></div>
<div class="admonition help">
<p class="admonition-title">Help</p>
<p>To clone the repository you can run:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/Materials-Consortia/optimade-python-tools.git
</code></pre></div>
</div>
<p>You should change the <code>/path/to/optimade-python-tools</code> to the full local path to the repository - or use <code>$PWD</code> if you are running this command from the root of the cloned repository on a Unix system.
Equivalently, <code>%cd%</code> should work on Windows.</p>
<p>In this setup you can change the repository root file <code>optimade_config.json</code> with the appropriate information.
E.g., if you do not wish to use the test data you can add the <code>insert_test_data</code> key with a value of <code>false</code>.</p>
<p>Another option is to <em>not</em> <code>git clone</code> the repository locally, but instead only generate a JSON or YAML file somewhere, where the directory of its location is bound to another location in the container that is not used, e.g., <code>/config</code> or similar.
As an example, let us say we generate <code>config.yml</code> locally, with the full path <code>/home/user/optimade/config.yml</code>.
Then we can start the server with the following command:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># volume will bind the local directory to an unused folder in the container.</span>
docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--detach<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--publish<span class="w"> </span><span class="m">8080</span>:5000<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">MAIN</span><span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>my-optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--volume<span class="w"> </span>/home/user/optimade:/config<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">OPTIMADE_CONFIG_FILE</span><span class="o">=</span>/config/config.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ghcr.io/materials-consortia/optimade:latest
</code></pre></div>
<p>As shown, it is necessary to update the environment variable <code>OPTIMADE_CONFIG_FILE</code> within the container to point to the new internal path to the config file.
By default, this environment variable points to <code>/app/optimade_config.json</code>.</p>
<p>This also reveals another way of configuring the server: set environment variables when running the container to supply values that would otherwise be supplied from the configuration file.</p>
<p>The <code>docker run</code> command even has the opportunity to pass a path to a file containing a list of environment variables (<code>--env-file /path/to/env_file</code>), if you wish to configure the server in this way instead of through the standard configuration file.</p>
<h2 id="example-multiple-container-services-in-closed-network"><strong>Example</strong>: Multiple container services in closed network<a class="headerlink" href="#example-multiple-container-services-in-closed-network" title="Permanent link">&para;</a></h2>
<p>In this example we want to setup various services through containers that interact with each other on a closed internal network, only the OPTIMADE servers are exposed to the "outside".</p>
<p>For this example we will use Docker only.
One could choose to use the <a href="https://docs.docker.com/compose/">Docker Compose</a> framework to neatly express the services in a single YAML file, however, to keep this compatible with Docker alternatives, we will focus on only using Docker.</p>
<p>We will also setup an index meta-database, with an associated OPTIMADE server, serving data from a MongoDB backend.
Hence, we need to run three separate services, configure it properly, and make sure only the OPTIMADE APIs are exposed.</p>
<h3 id="1-setup-closed-network">1. Setup closed network<a class="headerlink" href="#1-setup-closed-network" title="Permanent link">&para;</a></h3>
<p>First, we want to create the internal network:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>bridge<span class="w"> </span>optimade
</code></pre></div>
<h3 id="2-run-mongodb-service">2. Run MongoDB service<a class="headerlink" href="#2-run-mongodb-service" title="Permanent link">&para;</a></h3>
<p>Then, we can create a volume for the MongoDB server to use and start it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This can be setup in other ways, binding to local paths or otherwise.
For more information on the specifics of how to use the MongoDB container image, see <a href="https://hub.docker.com/_/mongo">the Docker Hub documentation</a>.
For more information from the MongoDB team concerning the Enterprise version, see <a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-enterprise-with-docker/">the MongoDB documentation</a>.</p>
</div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>volume<span class="w"> </span>create<span class="w"> </span>mongodb-persist
<span class="c1"># `mongo` will be the host name in the docker network, using `--name`.</span>
docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--detach<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>mongo<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--volume<span class="w"> </span>mongodb-persist:/data/db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>docker.io/library/mongo:latest
</code></pre></div>
<p>At this point you should fill up the database with your data, or instead of doing the command above exactly, you could choose to bind to another "local" path that contains an existing MongoDB you have.</p>
<p>Most likely, you will have a database dump archive, which you will now be able to import.
If you do so, please note the name of the database, the collection, and consider any data model mappings from your data to OPTIMADE data models for <em>structures</em> and/or <em>references</em>.</p>
<p>In the example, we assume the database has been filled with fully valid OPTIMADE <em>structures</em> and <em>references</em> in a database called <strong>optimade_prod</strong>, within the collections <strong>structures</strong> and <strong>references</strong>, respectively.</p>
<h3 id="3-run-the-optimade-service">3. Run the OPTIMADE service<a class="headerlink" href="#3-run-the-optimade-service" title="Permanent link">&para;</a></h3>
<p>With this information, we can now start the OPTIMADE server:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--detach<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--publish<span class="w"> </span><span class="m">8081</span>:5000<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">MAIN</span><span class="o">=</span>main<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>my-optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">OPTIMADE_CONFIG_FILE</span><span class="o">=</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_insert_test_data</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_database_backend</span><span class="o">=</span>mongodb<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_mongo_uri</span><span class="o">=</span>mongodb://mongo:27017<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_mongo_database</span><span class="o">=</span>optimade_prod<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_references_collection</span><span class="o">=</span>references<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_structures_collection</span><span class="o">=</span>structures<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_page_limit</span><span class="o">=</span><span class="m">25</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_page_limit_max</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_base_url</span><span class="o">=</span>http://localhost:8081<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_index_base_url</span><span class="o">=</span>http://localhost:8080<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_provider</span><span class="o">=</span><span class="s2">&quot;{\&quot;prefix\&quot;:\&quot;myorg\&quot;,\&quot;name\&quot;:\&quot;My Organization\&quot;,\&quot;description\&quot;:\&quot;Short description for My Organization\&quot;,\&quot;homepage\&quot;:\&quot;https://example.org\&quot;}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ghcr.io/materials-consortia/optimade:latest
</code></pre></div>
<p>Note, the <code>optimade_base_url</code> and <code>optimade_index_base_url</code> values should be different if the server is run through a reverse-proxy service like NGINX, Apache or other.
For this example, we are only concerned with exposing the OPTIMADE APIs from the <code>localhost</code>.</p>
<p>Furthermore, note that we "unset" the <code>OPTIMADE_CONFIG_FILE</code> environment variable to ensure the system defaults are used instead of configuration values that matches the test data.</p>
<h3 id="4-setup-and-run-the-optimade-index-meta-database-service">4. Setup and run the OPTIMADE index meta-database service<a class="headerlink" href="#4-setup-and-run-the-optimade-index-meta-database-service" title="Permanent link">&para;</a></h3>
<p>The next step is to start the OPTIMADE index meta-database.
For this, we will first create a JSON file to reference and load as data for the <code>/links</code> endpoint:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-optimade-db&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;links&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My OPTIMADE API&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;An OPTIMADE API for my database of essential material structures.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;base_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:8081&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;homepage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.org&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;link_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>This file is stored in a newly created directory at <code>/home/user/optimade/index_data/index_links.json</code>.</p>
<p>Now, we can start the index meta-database server:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># `optimade_insert_test_data` needs to be `true` to insert JSON file data</span>
docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--detach<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--publish<span class="w"> </span><span class="m">8080</span>:5000<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">MAIN</span><span class="o">=</span>main_index<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>my-optimade-index<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network<span class="w"> </span>optimade<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">OPTIMADE_CONFIG_FILE</span><span class="o">=</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_insert_test_data</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_database_backend</span><span class="o">=</span>mongodb<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_mongo_uri</span><span class="o">=</span>mongodb://mongo:27017<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_mongo_database</span><span class="o">=</span>optimade_index_prod<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_links_collection</span><span class="o">=</span>links<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_page_limit</span><span class="o">=</span><span class="m">25</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_page_limit_max</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_base_url</span><span class="o">=</span>http://localhost:8080<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_index_base_url</span><span class="o">=</span>http://localhost:8080<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_provider</span><span class="o">=</span><span class="s2">&quot;{\&quot;prefix\&quot;:\&quot;myorg\&quot;,\&quot;name\&quot;:\&quot;My Organization\&quot;,\&quot;description\&quot;:\&quot;Short description for My Organization\&quot;,\&quot;homepage\&quot;:\&quot;https://example.org\&quot;}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_default_db</span><span class="o">=</span>my-optimade-db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--env<span class="w"> </span><span class="nv">optimade_index_links_path</span><span class="o">=</span>/external/index_data/index_links.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--volume<span class="w"> </span>/home/user/optimade/index_data:/external/index_data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ghcr.io/materials-consortia/optimade:latest
</code></pre></div>
<h3 id="5-test-the-services">5. Test the services<a class="headerlink" href="#5-test-the-services" title="Permanent link">&para;</a></h3>
<p>Finally, we can test it all works as intended.</p>
<p>Go to <a href="http://localhost:8080/links">localhost:8080/links</a> to check you see the list of OPTIMADE databases linked to by the index meta-database.
This list should include the entry from the JSON file above with ID <code>my-optimade-db</code>.</p>
<p>You could from there go to <a href="http://localhost:8081/info">localhost:8081/info</a> and see the introspective information about the OPTIMADE database.
Furthermore, now you could go search through the material structures in your database, e.g., retrieving all structures that include carbon and oxygen in their list of chemical elements: <a href="http://localhost:8081/structures?filter=elements%20HAS%20ALL%20%22C%22%2C%22O%22">localhost:8081/structures?filter=elements HAS ALL "C","O"</a>.</p>
<p>It is also good to test the limits we specified are upheld, e.g., the maximum number of requested entries is not allowed to exceed 100 according to the <code>optimade_page_limit_max</code> value we have specified.
To test this, we could request a response with 101 entries, which should return an error: <a href="http://localhost:8081/structures?page_limit=101">localhost:8081/structures?page_limit=101</a>.
And then a request for a response with 101 entries, which should <em>not</em> return an error: <a href="http://localhost:8081/structures?page_limit=100">localhost:8081/structures?page_limit=100</a>.</p>
<p>If you wish to inspect the logs of any service, you can use the <code>docker logs</code> command, followed by any of the service container names, e.g., <code>docker logs my-optimade</code> will display the logged <code>stdout</code> and <code>stderr</code> from the OPTIMADE database server.</p>
<!-- markdownlint-disable MD046 -->
<div class="admonition example">
<p class="admonition-title">Use the test data</p>
<p>If you do not have any data with which to fill up the MongoDB backend, you can run through the example using test data with some minor changes.
However, it is crucial you first <code>git clone</code> the repository locally, since the test data is included only in the repository - not the container image.</p>
<p>Run all <code>docker</code> commands from the root of the cloned repository.</p>
<p>When running the OPTIMADE servers, leave out the line concerning "unsetting" the <code>OPTIMADE_CONFIG_FILE</code> environment variable.
When first running the OPTIMADE server (not the index meta-database) set the <code>optimade_insert_test_data</code> value to <code>true</code>.
If you stop the server and want to restart it, you should then set the variable to <code>false</code>, since the startup of the server will otherwise fail, due to the test data already existing in the MongoDB database collections and the subsequent re-insertion will throw an error.</p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Built by the Materials-Consortia
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/Materials-Consortia" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>